<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>hoROOMy parsers</title>

	<script type="text/javascript">



		function get(ourl) {

			var nurl = "/parse_status/" + ourl
			var r = new XMLHttpRequest();
			r.open('GET', nurl);
			r.send();
			r.onreadystatechange=function() { if (r.readyState == 4) {
				var resp = r.responseText;
				document.getElementById(ourl).innerHTML = resp;
				console.log("resp")
				if (resp.indexOf("last updated on:") == -1) {document.getElementById("stp").disabled = true; console.log("disabled");}
				else {document.getElementById("stp").disabled = false; console.log("enabled");}}}
		}

		
		function fill_status() {
			parsers = {{plist}};
			parsers.forEach(function(parser, i) {
				get(parser);
			})
		}


		window.onload = setInterval(fill_status, 1500);


	</script>
</head>
<body>

{parserdivs}

	<div style="margin-bottom: 10%">
	</div>

	<form action="/start_parse" onsubmit="document.getElementById('stp').disabled = true; await sleep(1000);" method="GET">
	<input type="number" placeholder="Макс цена, руб" name="maxprice">
	<input type="submit" id="stp" value="Начать парсинг" disabled>
	</form>

</body>
</html>