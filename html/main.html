<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>hoROOMy parsers</title>

	<script type="text/javascript">



		function get(ourl) {

			var nurl = "/parse_status/" + ourl
			var r = new XMLHttpRequest();
			r.open('GET', nurl);
			r.send();
			r.onreadystatechange=function() { if (r.readyState == 4) {
				var resp = r.responseText;
				document.getElementById(ourl).innerHTML = resp;
				if (resp.indexOf("last updated on:") != -1) {document.getElementById("stp").disabled = true; console.log("disabled");}
				else {document.getElementById("stp").disabled = false; console.log("enabled");}}}
		}
		
		function fill_status() {
			parsers = ['cian', 'other'];
			parsers.forEach(function(parser, i) {
				get(parser);
			})
		}

		window.onload = setInterval(fill_status, 1500);

	</script>
</head>
<body>

	<div>
		<span style="margin-right: 20%; margin-left: 3%;">cian:</span><span id="cian" style="margin-right: 17%;">xtnf</span><button onclick="window.location = '/res/cian';" id="reults">Просмотреть результаты</a>
	</div>
	<div style="margin-bottom: 10%">
		<span style="margin-right: 20%; margin-left: 3%;">other:</span><span id="other">fff</span>
	</div>
	<form action="/start_parse" method="GET"> <input type="submit" id="stp" value="Начать парсинг" disabled> </form>

</body>
</html>